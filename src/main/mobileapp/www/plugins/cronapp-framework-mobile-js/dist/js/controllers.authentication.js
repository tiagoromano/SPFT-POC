!function(o){angular.module("custom.controllers",[]);var e=function(o,e,t,n){window.hostApp?e({method:"GET",url:window.hostApp+"auth/refresh"}).success(function(r,i,a,l){console.log("revive :",new Date(r.expires)),localStorage.setItem("_u",JSON.stringify(r)),setTimeout(function(){$scope.refreshToken(o,e,t,n)},18e5),t()}).error(function(){n()}):o.error("HostApp is required to refresh token!")};app.controller("LoginController",["$scope","$http","$location","$rootScope","$window","$state","$translate","Notification","$ionicLoading","$timeout","$stateParams","$ionicModal",function(o,t,n,r,i,a,l,s,c,p,u,d){function f(o,e,t,n){"undefined"!=typeof Storage&&localStorage.setItem("_u",JSON.stringify(o)),a.go("app.home"),p(function(){c.hide()},500)}function h(o,e,t,n){var r=401==e?l.instant("Login.view.invalidPassword"):o;r||(r=l.instant("General.ErrorNotSpecified")),console.log(r),c.hide(),s.error(r)}app.registerEventsCronapi(o,l,d,c),r.http=t,o.Notification=s,o.params=u;var g=n.search();for(var m in g)g.hasOwnProperty(m)&&(o.params[m]=g[m]);for(var v in app.userEvents)o[v]=app.userEvents[v].bind(o);o.autoLogin=function(){localStorage.getItem("_u")&&e(s,t,function(){a.go("app.home")},function(){localStorage.removeItem("_u")})},o.autoLogin(),o.user={username:"",password:""},o.message={},o.login=function(){o.message.error=void 0,window.hostApp?(this.cronapi.screen.showLoading(),t({method:"POST",url:window.hostApp+"auth",data:$.param(o.user),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(f).error(h)):s.error("HostApp is required!")},r.infiniteReached=function(){};try{var w=$controller("AfterLoginController",{$scope:o});app.copyContext(w,this,"AfterLoginController")}catch(o){}try{o.blockly.events.afterLoginRender&&o.blockly.events.afterLoginRender()}catch(o){}}]),app.controller("HomeController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading","$stateParams","$location",function(o,t,n,r,i,a,l,s,c,p,u,d){app.registerEventsCronapi(o,a,c,p),n.http=t,o.Notification=l,o.params=u;var $=d.search();for(var f in $)$.hasOwnProperty(f)&&(o.params[f]=$[f]);for(var h in app.userEvents)o[h]=app.userEvents[h].bind(o);n.session=localStorage._u?JSON.parse(localStorage._u):null,n.session?n.session.token&&e(l,t,function(){},n.logout):o.ignoreAuth||("undefined"!=typeof Storage&&sessionStorage.removeItem("_u"),r.go("login"))}]),app.controller("PublicController",["$controller","$scope",function(o,e){e.ignoreAuth=!0,angular.extend(this,o("HomeController",{$scope:e}))}]),app.controller("MenuController",["$scope","$http","$rootScope","$state","$timeout","$translate","Notification","$ionicHistory","$ionicModal","$ionicLoading",function(o,e,t,n,r,i,a,l,s,c){app.registerEventsCronapi(o,i,s,c),t.http=e,o.Notification=a,o.folder="logged";for(var p in app.userEvents)o[p]=app.userEvents[p].bind(o);o.ignoreAuth||(s.fromTemplateUrl("views/logged/_changepassword.view.html",{scope:o,animation:"slide-in-up"}).then(function(e){o.modal=e}),o.openChangePassword=function(){o.modal.modelEl?o.modal.show():e({url:"views/logged/_changepassword.view.html"}).then(function(e){o.modal=s.fromTemplate($(e.data).last().text(),{scope:o,animation:"slide-in-up"}),o.modal.show()})},o.closeChangePassword=function(){o.modal.hide()},o.logout=function(){t.session=null,localStorage.removeItem("_u"),n.go("login")}),o.http({method:"GET",url:"views/"+o.folder+"/menu.view.html"}).then(function(e){$(e.data).find("ion-nav-bar").length>0?(o.isOldMenu=!0,$(document).find("ion-header-bar").length>0&&$(document).find("ion-nav-bar").show()):o.isOldMenu=!1})}]),app.controller("PublicMenuController",["$controller","$scope",function(o,e){e.folder="public",angular.extend(this,o("MenuController",{$scope:e}))}]),app.controller("InitialController",["$scope","$stateParams","$http","Notification","$location","$rootScope","$translate","$ionicModal","$ionicLoading",function(o,e,t,n,r,i,a,l,s){app.registerEventsCronapi(o,a,l,s),i.http=t,o.Notification=n,o.params=e,o.$http=t,o.blockly.js.blockly.auth.Home.change()}]),app.controller("chatController",["$scope","$state","$ionicPopup","$ionicScrollDelegate","$timeout","$interval","$ionicModal","$translate","$rootScope","$http","Notification",function(o,e,t,n,r,i,a,l,s,c,p){app.registerEventsCronapi(o,l,a,$ionicLoading),s.http=c,o.Notification=p;for(var u in app.userEvents)o[u]=app.userEvents[u].bind(o);var d,f,h,g=(JSON.parse(localStorage._u).user.username,n.$getByHandle("userMessageScroll"));o.enter=function(){r(function(){d=document.body.querySelector(".homeView .bar-footer"),f=document.body.querySelector(".homeView .scroll-content"),h=angular.element(d.querySelector("textarea"))},0)},o.isEnter=function(o){13==o.keyCode&&r(function(){o.stopPropagation(),$("#sendButton").trigger("click")},0)},o.refreshScroll=function(e,t){r(function(){e=e||o.scrollDown,g.resize(),e&&g.scrollBottom(!0),o.checkScroll()},t||1e3)},o.scrollDown=!0,o.checkScroll=function(){return r(function(){var e=g.getScrollPosition().top,t=g.getScrollView().__maxScrollTop;o.scrollDown=e>=t,o.$apply()},0),!0}}]),app.controller("PageController",["$scope","$stateParams","Notification","$location","$http","$rootScope","$translate","$ionicModal","$ionicLoading",function(o,e,t,n,r,i,a,l,s){app.registerEventsCronapi(o,a,l,s),i.http=r,o.Notification=t,o.params=e,o.$http=r,o.listCanSwipe=!0;var c=n.search();for(var p in c)c.hasOwnProperty(p)&&(o.params[p]=c[p]);if(o.registerComponentScripts=function(){$(".carousel-indicators li").on("click",function(){var o="#"+$(this).parent().parent().parent().attr("id"),e=$(o+" .carousel-indicators li").index(this);$(o+" #carousel-example-generic").carousel(e)})},o.registerComponentScripts(),o.isOldMenu){var u=o.params.name||"home";o.http({method:"GET",url:"views/logged/"+u+".view.html"}).then(function(o){$(o.data).find("ion-header-bar").length>0?$(document).find("ion-nav-bar").hide():$(document).find("ion-header-bar").length>0&&$(document).find("ion-nav-bar").show()})}try{var d=$controller("AfterPageController",{$scope:o});app.copyContext(d,this,"AfterPageController")}catch(o){}}]),app.controller("InitialController",["$scope","$stateParams","$http","Notification","$location","$rootScope","$translate","$ionicModal","$ionicLoading",function(o,e,t,n,r,i,a,l,s){app.registerEventsCronapi(o,a,l,s),i.http=t,o.Notification=n,o.params=e,o.$http=t;var c=r.search();for(var p in c)c.hasOwnProperty(p)&&(o.params[p]=c[p]);o.blockly.js.blockly.auth.Home.change()}])}(app),window.safeApply=function(o){var e=this.$root.$$phase;"$apply"==e||"$digest"==e?o&&"function"==typeof o&&o():this.$apply(o)};